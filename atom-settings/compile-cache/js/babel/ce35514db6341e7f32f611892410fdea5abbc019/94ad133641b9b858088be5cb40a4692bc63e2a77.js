'use babel';

var $ = require('jquery');
var Prism = require('prismjs');
var Url = require('url');

var Highlight = function Highlight(type, rootNode) {
  if (type in Highlight) {
    Highlight[type](rootNode);
  }
};

Highlight.one = function (node, language) {
  node.classList.add('language-' + language);
  Prism.highlightElement(node);
};

Highlight.all = function (nodes, language) {
  for (var i = 0; i < nodes.length; ++i) {
    Highlight.one(nodes[i], language);
  }
};

Highlight.angular = function (rootNode) {
  var elements = rootNode.getElementsByTagName('pre');
  for (var i = 0; i < elements.length; ++i) {
    var element = elements[i];
    var language = 'javascript';
    if (element.classList.contains('lang-html') || element.textContent[0] == '<') {
      language = 'markup';
    } else if (element.classList.contains('lang-css')) {
      language = 'css';
    }
    element.className = '';
    Highlight.one(element, language);
  }
};

Highlight.bower = function (rootNode) {
  Highlight.all($(rootNode).find('pre[data-lang="js"], pre[data-lang="json"]'), 'javascript');
};

Highlight.c = function (rootNode) {
  Highlight.all($(rootNode.find('pre.source-c, .source-c > pre')), 'c');
  Highlight.all($(rootNode.find('pre.source-cpp, .source-cpp > pre')), 'cpp');
};

Highlight.coffeescript = function (rootNode) {
  Highlight.all($(rootNode).find('.code > pre:first-child'), 'coffeescript');
  Highlight.all($(rootNode).find('.code > pre:last-child'), 'javascript');
};

Highlight.d3 = function (rootNode) {
  Highlight.all($(rootNode).find('.highlight > pre'));
};

Highlight.ember = function (rootNode) {
  var elements = rootNode.getElementsByTagName('pre');
  for (var i = 0; i < elements.length; ++i) {
    var element = elements[i];
    if (element.classList.contains('javascript')) {
      Highlight.one(element, 'javascript');
    } else if (element.classList.contains('html')) {
      Highlight.one(element, 'markup');
    }
  }
};

Highlight.go = function (rootNode) {
  Highlight.all(rootNode.getElementsByTagName('pre'), 'go');
};

// TODO: jquery

Highlight.knockout = function (rootNode) {
  var elements = rootNode.getElementsByTagName('pre');
  for (var i = 0; i < elements.length; ++i) {
    var element = elements[i];
    if (element.innerHTML.indexOf('data-bind="') > 0) {
      Highlight.one(element, 'markup');
    } else {
      Highlight.one(element, 'javascript');
    }
  }
};

Highlight.mdn = function (rootNode) {
  var elements = $(rootNode).find('pre[class^="brush"]');
  for (var i = 0; i < elements.length; ++i) {
    var language = elements[i].className.match(/brush: ?(\w+)/)[1].replace('html', 'markup').replace('js', 'javascript');
    elements[i].className = '';
    Highlight.one(elements[i], language);
  }
};

Highlight.php = function (rootNode) {
  Highlight.all(rootNode.getElementsByClassName('phpcode'), 'php');
};

Highlight.phpunit = function (rootNode) {
  Highlight.all($(rootNode).find('pre.programlisting'), 'php');
};

Highlight.rdoc = function (rootNode) {
  Highlight.all($(rootNode).find('pre.ruby'), 'ruby');
  Highlight.all($(rootNode).find('pre.c'), 'clike');
};

Highlight.react = function (rootNode) {
  var elements = rootNode.getElementsByTagName('pre');
  for (var i = 0; i < elements.length; ++i) {
    var element = elements[i];
    var attribute = element.getAttribute('data-lang');
    if (attribute == 'html') {
      Highlight.one(element, 'markup');
    } else if (attribute == 'javascript') {
      Highlight.one(element, 'javascript');
    }
  }
};

Highlight.sphinx = function (rootNode) {
  Highlight.all($(rootNode).find('pre.python'), 'python');
  Highlight.all($(rootNode).find('pre.markup'), 'markup');
};

Highlight.chai = Highlight.express = Highlight.grunt = Highlight.lodash = Highlight.marionette = Highlight.modernizr = Highlight.moment = Highlight.mongoose = Highlight.node = Highlight.rethinkdb = Highlight.sinon = Highlight.underscore = function (rootNode) {
  Highlight.all(rootNode.getElementsByTagName('pre'), 'javascript');
};

Highlight.requirejs = Highlight.socketio = function (rootNode) {
  var elements = rootNode.getElementsByTagName('pre');
  for (var i = 0; i < elements.length; ++i) {
    if (elements[i].textContent.match(/^\s*</)) {
      Highlight.one(elements[i], 'markup');
    } else {
      Highlight.one(elements[i], 'javascript');
    }
  }
};

module.exports = Highlight;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2F2aXJhanMvLmF0b20vcGFja2FnZXMvYXBpLWRvY3Mvc3JjL2hpZ2hsaWdodC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7O0FBRVosSUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVCLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNqQyxJQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7O0FBRTNCLElBQU0sU0FBUyxHQUFHLFNBQVosU0FBUyxDQUFZLElBQUksRUFBRSxRQUFRLEVBQUU7QUFDekMsTUFBSSxJQUFJLElBQUksU0FBUyxFQUFFO0FBQ3JCLGFBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztHQUMzQjtDQUNGLENBQUM7O0FBRUYsU0FBUyxDQUFDLEdBQUcsR0FBRyxVQUFDLElBQUksRUFBRSxRQUFRLEVBQUs7QUFDbEMsTUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0FBQzNDLE9BQUssQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUM5QixDQUFDOztBQUVGLFNBQVMsQ0FBQyxHQUFHLEdBQUcsVUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFLO0FBQ25DLE9BQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO0FBQ3JDLGFBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0dBQ25DO0NBQ0YsQ0FBQzs7QUFFRixTQUFTLENBQUMsT0FBTyxHQUFHLFVBQUEsUUFBUSxFQUFJO0FBQzlCLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN0RCxPQUFLLElB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QUUsQ0FBQyxFQUFFO0FBQ3hDLFFBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUU7QUFDMUMsZUFBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7S0FDdEMsTUFBTTtBQUNMLGVBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDO0tBQzFDO0dBQ0Y7Q0FDRixDQUFDOztBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDIiwiZmlsZSI6Ii9ob21lL2F2aXJhanMvLmF0b20vcGFja2FnZXMvYXBpLWRvY3Mvc3JjL2hpZ2hsaWdodC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuXG5jb25zdCAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG5jb25zdCBQcmlzbSA9IHJlcXVpcmUoJ3ByaXNtanMnKTtcbmNvbnN0IFVybCA9IHJlcXVpcmUoJ3VybCcpO1xuXG5jb25zdCBIaWdobGlnaHQgPSBmdW5jdGlvbih0eXBlLCByb290Tm9kZSkge1xuICBpZiAodHlwZSBpbiBIaWdobGlnaHQpIHtcbiAgICBIaWdobGlnaHRbdHlwZV0ocm9vdE5vZGUpO1xuICB9XG59O1xuXG5IaWdobGlnaHQub25lID0gKG5vZGUsIGxhbmd1YWdlKSA9PiB7XG4gIG5vZGUuY2xhc3NMaXN0LmFkZCgnbGFuZ3VhZ2UtJyArIGxhbmd1YWdlKTtcbiAgUHJpc20uaGlnaGxpZ2h0RWxlbWVudChub2RlKTtcbn07XG5cbkhpZ2hsaWdodC5hbGwgPSAobm9kZXMsIGxhbmd1YWdlKSA9PiB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyArK2kpIHtcbiAgICBIaWdobGlnaHQub25lKG5vZGVzW2ldLCBsYW5ndWFnZSk7XG4gIH1cbn07XG5cbkhpZ2hsaWdodC5hbmd1bGFyID0gcm9vdE5vZGUgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHJvb3ROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdwcmUnKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7ICsraSkge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBlbGVtZW50c1tpXTtcbiAgICBsZXQgbGFuZ3VhZ2UgPSAnamF2YXNjcmlwdCc7XG4gICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsYW5nLWh0bWwnKSB8fCBlbGVtZW50LnRleHRDb250ZW50WzBdID09ICc8Jykge1xuICAgICAgbGFuZ3VhZ2UgPSAnbWFya3VwJztcbiAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsYW5nLWNzcycpKSB7XG4gICAgICBsYW5ndWFnZSA9ICdjc3MnO1xuICAgIH1cbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9ICcnO1xuICAgIEhpZ2hsaWdodC5vbmUoZWxlbWVudCwgbGFuZ3VhZ2UpO1xuICB9XG59O1xuXG5IaWdobGlnaHQuYm93ZXIgPSByb290Tm9kZSA9PiB7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZSkuZmluZCgncHJlW2RhdGEtbGFuZz1cImpzXCJdLCBwcmVbZGF0YS1sYW5nPVwianNvblwiXScpLCAnamF2YXNjcmlwdCcpO1xufTtcblxuSGlnaGxpZ2h0LmMgPSByb290Tm9kZSA9PiB7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZS5maW5kKCdwcmUuc291cmNlLWMsIC5zb3VyY2UtYyA+IHByZScpKSwgJ2MnKTtcbiAgSGlnaGxpZ2h0LmFsbCgkKHJvb3ROb2RlLmZpbmQoJ3ByZS5zb3VyY2UtY3BwLCAuc291cmNlLWNwcCA+IHByZScpKSwgJ2NwcCcpO1xufTtcblxuSGlnaGxpZ2h0LmNvZmZlZXNjcmlwdCA9IHJvb3ROb2RlID0+IHtcbiAgSGlnaGxpZ2h0LmFsbCgkKHJvb3ROb2RlKS5maW5kKCcuY29kZSA+IHByZTpmaXJzdC1jaGlsZCcpLCAnY29mZmVlc2NyaXB0Jyk7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZSkuZmluZCgnLmNvZGUgPiBwcmU6bGFzdC1jaGlsZCcpLCAnamF2YXNjcmlwdCcpO1xufTtcblxuSGlnaGxpZ2h0LmQzID0gcm9vdE5vZGUgPT4ge1xuICBIaWdobGlnaHQuYWxsKCQocm9vdE5vZGUpLmZpbmQoJy5oaWdobGlnaHQgPiBwcmUnKSk7XG59O1xuXG5IaWdobGlnaHQuZW1iZXIgPSByb290Tm9kZSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gcm9vdE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3ByZScpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRzW2ldO1xuICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnamF2YXNjcmlwdCcpKSB7XG4gICAgICBIaWdobGlnaHQub25lKGVsZW1lbnQsICdqYXZhc2NyaXB0Jyk7XG4gICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnaHRtbCcpKSB7XG4gICAgICBIaWdobGlnaHQub25lKGVsZW1lbnQsICdtYXJrdXAnKTtcbiAgICB9XG4gIH1cbn07XG5cbkhpZ2hsaWdodC5nbyA9IHJvb3ROb2RlID0+IHtcbiAgSGlnaGxpZ2h0LmFsbChyb290Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJlJyksICdnbycpO1xufTtcblxuLy8gVE9ETzoganF1ZXJ5XG5cbkhpZ2hsaWdodC5rbm9ja291dCA9IHJvb3ROb2RlID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSByb290Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJlJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudHNbaV07XG4gICAgaWYgKGVsZW1lbnQuaW5uZXJIVE1MLmluZGV4T2YoJ2RhdGEtYmluZD1cIicpID4gMCkge1xuICAgICAgSGlnaGxpZ2h0Lm9uZShlbGVtZW50LCAnbWFya3VwJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEhpZ2hsaWdodC5vbmUoZWxlbWVudCwgJ2phdmFzY3JpcHQnKTtcbiAgICB9XG4gIH1cbn07XG5cbkhpZ2hsaWdodC5tZG4gPSByb290Tm9kZSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gJChyb290Tm9kZSkuZmluZCgncHJlW2NsYXNzXj1cImJydXNoXCJdJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBsYW5ndWFnZSA9IGVsZW1lbnRzW2ldLmNsYXNzTmFtZS5tYXRjaCgvYnJ1c2g6ID8oXFx3KykvKVsxXS5yZXBsYWNlKCdodG1sJywgJ21hcmt1cCcpLnJlcGxhY2UoJ2pzJywgJ2phdmFzY3JpcHQnKTtcbiAgICBlbGVtZW50c1tpXS5jbGFzc05hbWUgPSAnJztcbiAgICBIaWdobGlnaHQub25lKGVsZW1lbnRzW2ldLCBsYW5ndWFnZSk7XG4gIH1cbn07XG5cbkhpZ2hsaWdodC5waHAgPSByb290Tm9kZSA9PiB7XG4gIEhpZ2hsaWdodC5hbGwocm9vdE5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncGhwY29kZScpLCAncGhwJyk7XG59O1xuXG5IaWdobGlnaHQucGhwdW5pdCA9IHJvb3ROb2RlID0+IHtcbiAgSGlnaGxpZ2h0LmFsbCgkKHJvb3ROb2RlKS5maW5kKCdwcmUucHJvZ3JhbWxpc3RpbmcnKSwgJ3BocCcpO1xufTtcblxuSGlnaGxpZ2h0LnJkb2MgPSByb290Tm9kZSA9PiB7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZSkuZmluZCgncHJlLnJ1YnknKSwgJ3J1YnknKTtcbiAgSGlnaGxpZ2h0LmFsbCgkKHJvb3ROb2RlKS5maW5kKCdwcmUuYycpLCAnY2xpa2UnKTtcbn07XG5cbkhpZ2hsaWdodC5yZWFjdCA9IHJvb3ROb2RlID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSByb290Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJlJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudHNbaV07XG4gICAgY29uc3QgYXR0cmlidXRlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbGFuZycpO1xuICAgIGlmIChhdHRyaWJ1dGUgPT0gJ2h0bWwnKSB7XG4gICAgICBIaWdobGlnaHQub25lKGVsZW1lbnQsICdtYXJrdXAnKTtcbiAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZSA9PSAnamF2YXNjcmlwdCcpIHtcbiAgICAgIEhpZ2hsaWdodC5vbmUoZWxlbWVudCwgJ2phdmFzY3JpcHQnKTtcbiAgICB9XG4gIH1cbn07XG5cbkhpZ2hsaWdodC5zcGhpbnggPSByb290Tm9kZSA9PiB7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZSkuZmluZCgncHJlLnB5dGhvbicpLCAncHl0aG9uJyk7XG4gIEhpZ2hsaWdodC5hbGwoJChyb290Tm9kZSkuZmluZCgncHJlLm1hcmt1cCcpLCAnbWFya3VwJyk7XG59O1xuXG5IaWdobGlnaHQuY2hhaSA9XG5IaWdobGlnaHQuZXhwcmVzcyA9XG5IaWdobGlnaHQuZ3J1bnQgPVxuSGlnaGxpZ2h0LmxvZGFzaCA9XG5IaWdobGlnaHQubWFyaW9uZXR0ZSA9XG5IaWdobGlnaHQubW9kZXJuaXpyID1cbkhpZ2hsaWdodC5tb21lbnQgPVxuSGlnaGxpZ2h0Lm1vbmdvb3NlID1cbkhpZ2hsaWdodC5ub2RlID1cbkhpZ2hsaWdodC5yZXRoaW5rZGIgPVxuSGlnaGxpZ2h0LnNpbm9uID1cbkhpZ2hsaWdodC51bmRlcnNjb3JlID0gcm9vdE5vZGUgPT4ge1xuICBIaWdobGlnaHQuYWxsKHJvb3ROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdwcmUnKSwgJ2phdmFzY3JpcHQnKTtcbn07XG5cbkhpZ2hsaWdodC5yZXF1aXJlanMgPVxuSGlnaGxpZ2h0LnNvY2tldGlvID0gcm9vdE5vZGUgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHJvb3ROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdwcmUnKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7ICsraSkge1xuICAgIGlmIChlbGVtZW50c1tpXS50ZXh0Q29udGVudC5tYXRjaCgvXlxccyo8LykpIHtcbiAgICAgIEhpZ2hsaWdodC5vbmUoZWxlbWVudHNbaV0sICdtYXJrdXAnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgSGlnaGxpZ2h0Lm9uZShlbGVtZW50c1tpXSwgJ2phdmFzY3JpcHQnKTtcbiAgICB9XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSGlnaGxpZ2h0O1xuIl19